# Base math test configurations
# Each test validates a specific constraint or set of constraints from the base math

storage_max:
  description: "Test storage_max constraint"
  math:
    constraints: [storage_max]
  overrides: {}
  scenario: simple_storage,two_hours,investment_costs
  lp_file: storage_max.lp

flow_out_max:
  description: "Test flow_out_max constraint"
  math:
    constraints: [flow_out_max]
  overrides: {}
  scenario: simple_supply,two_hours,investment_costs
  lp_file: flow_out_max.lp

balance_conversion:
  description: "Test balance_conversion constraint"
  math:
    constraints: [balance_conversion]
  overrides: {}
  scenario: simple_conversion,two_hours,investment_costs
  lp_file: balance_conversion.lp

source_max:
  description: "Test source_max constraint"
  math:
    constraints: [source_max]
  overrides: {}
  scenario: simple_supply_plus,resample_two_days,investment_costs
  lp_file: source_max.lp

balance_transmission:
  description: "Test balance_transmission with one-way electricity transmission and two-way heat transmission"
  math:
    constraints: [balance_transmission]
  overrides:
    techs.test_link_a_b_elec.one_way: true
  scenario: simple_conversion,two_hours
  lp_file: balance_transmission.lp

balance_storage:
  description: "Test balance_storage with mixed cyclic_storage settings"
  math:
    constraints: [balance_storage]
  overrides:
    nodes.a.techs.test_storage.cyclic_storage: true
    nodes.b.techs.test_storage.cyclic_storage: false
  scenario: simple_storage,two_hours
  lp_file: balance_storage.lp

flow_capacity_per_storage_capacity_min:
  description: "Test flow_capacity_per_storage_capacity_min constraint"
  math:
    constraints: [flow_capacity_per_storage_capacity_min]
  overrides:
    nodes.a.techs.test_storage.flow_cap_per_storage_cap_min: 0.5
  scenario: simple_storage,two_hours,investment_costs
  lp_file: flow_capacity_per_storage_capacity_min.lp

flow_capacity_per_storage_capacity_max:
  description: "Test flow_capacity_per_storage_capacity_max constraint"
  math:
    constraints: [flow_capacity_per_storage_capacity_max]
  overrides:
    nodes.a.techs.test_storage.flow_cap_per_storage_cap_max: 2.0
  scenario: simple_storage,two_hours,investment_costs
  lp_file: flow_capacity_per_storage_capacity_max.lp

source_capacity_equals_flow_capacity:
  description: "Test source_capacity_equals_flow_capacity constraint"
  math:
    constraints: [source_capacity_equals_flow_capacity]
  overrides:
    nodes.a.techs.test_supply_plus.source_cap_equals_flow_cap: true
  scenario: simple_supply_plus,two_hours,investment_costs
  lp_file: source_capacity_equals_flow_capacity.lp

force_zero_area_use:
  description: "Test force_zero_area_use constraint"
  math:
    constraints: [force_zero_area_use]
  overrides:
    nodes.a.techs.test_supply_elec.flow_cap_max: 0
    nodes.a.techs.test_supply_elec.area_use_max: 100
  scenario: simple_supply,two_hours
  lp_file: force_zero_area_use.lp

area_use_per_flow_capacity:
  description: "Test area_use_per_flow_capacity constraint"
  math:
    constraints: [area_use_per_flow_capacity]
  overrides:
    nodes.a.techs.test_supply_elec.area_use_per_flow_cap: 1.5
  scenario: simple_supply,two_hours,investment_costs
  lp_file: area_use_per_flow_capacity.lp

area_use_capacity_per_loc:
  description: "Test area_use_capacity_per_loc constraint"
  math:
    constraints: [area_use_capacity_per_loc]
  overrides:
    nodes.a.techs.test_supply_elec.area_use_per_flow_cap: 1.0
    nodes.a.techs.test_supply_plus.area_use_per_flow_cap: 2.0
    nodes.a.available_area: 50
  scenario: simple_supply_and_supply_plus,two_hours,investment_costs
  lp_file: area_use_capacity_per_loc.lp

flow_capacity_systemwide_max:
  description: "Test flow_capacity_systemwide_max constraint"
  math:
    constraints: [flow_capacity_systemwide_max]
  overrides:
    techs.test_supply_elec.flow_cap_max_systemwide: 15
  scenario: simple_supply,two_hours,investment_costs
  lp_file: flow_capacity_systemwide_max.lp

flow_capacity_systemwide_min:
  description: "Test flow_capacity_systemwide_min constraint"
  math:
    constraints: [flow_capacity_systemwide_min]
  overrides:
    techs.test_supply_elec.flow_cap_min_systemwide: 5
  scenario: simple_supply,two_hours,investment_costs
  lp_file: flow_capacity_systemwide_min.lp

flow_out_min:
  description: "Test flow_out_min constraint"
  math:
    constraints: [flow_out_min]
  overrides:
    nodes.a.techs.test_supply_elec.flow_out_min_relative: 0.2
  scenario: simple_supply,two_hours,investment_costs
  lp_file: flow_out_min.lp

flow_in_max:
  description: "Test flow_in_max constraint"
  math:
    constraints: [flow_in_max]
  overrides: {}
  scenario: simple_conversion,two_hours,investment_costs
  lp_file: flow_in_max.lp

storage_discharge_depth_limit:
  description: "Test storage_discharge_depth_limit constraint"
  math:
    constraints: [storage_discharge_depth_limit]
  overrides:
    nodes.a.techs.test_storage.storage_discharge_depth: 0.2
  scenario: simple_storage,two_hours,investment_costs
  lp_file: storage_discharge_depth_limit.lp

system_balance:
  description: "Test system_balance constraint"
  math:
    constraints: [system_balance]
  overrides:
    config.build.ensure_feasibility: true
  scenario: simple_supply,two_hours
  lp_file: system_balance.lp

balance_demand:
  description: "Test balance_demand constraint"
  math:
    constraints: [balance_demand]
  overrides: {}
  scenario: simple_supply,two_hours,demand_elec_max
  lp_file: balance_demand.lp

balance_demand_min_use:
  description: "Test balance_demand_min_use constraint"
  math:
    constraints: [balance_demand_min_use]
  overrides:
    data_tables.demand_elec.add_dims.parameters: sink_use_min
  scenario: simple_supply,two_hours
  lp_file: balance_demand_min_use.lp

balance_supply_no_storage:
  description: "Test balance_supply_no_storage constraint"
  math:
    constraints: [balance_supply_no_storage]
  overrides: {}
  scenario: simple_supply,two_hours
  lp_file: balance_supply_no_storage.lp

balance_supply_with_storage:
  description: "Test balance_supply_with_storage constraint"
  math:
    constraints: [balance_supply_with_storage]
  overrides: {}
  scenario: simple_supply_plus,two_hours,investment_costs
  lp_file: balance_supply_with_storage.lp

source_availability_supply:
  description: "Test source_availability_supply constraint"
  math:
    constraints: [source_availability_supply]
  overrides: {}
  scenario: simple_supply_plus,resample_two_days,investment_costs
  lp_file: source_availability_supply.lp

balance_supply_min_use:
  description: "Test balance_supply_min_use constraint"
  math:
    constraints: [balance_supply_min_use]
  overrides:
    nodes.a.techs.test_supply_plus.source_use_min: 5
  scenario: simple_supply_plus,resample_two_days,investment_costs
  lp_file: balance_supply_min_use.lp

set_storage_initial:
  description: "Test set_storage_initial constraint"
  math:
    constraints: [set_storage_initial]
  overrides:
    nodes.a.techs.test_storage.storage_initial: 0.5
    nodes.a.techs.test_storage.cyclic_storage: true
  scenario: simple_storage,two_hours,investment_costs
  lp_file: set_storage_initial.lp

symmetric_transmission:
  description: "Test symmetric_transmission constraint"
  math:
    constraints: [symmetric_transmission]
  overrides: {}
  scenario: simple_conversion,two_hours
  lp_file: symmetric_transmission.lp

export_balance:
  description: "Test export_balance constraint"
  math:
    constraints: [export_balance]
  overrides:
    techs.test_supply_elec.carrier_export: electricity
    nodes.a.techs.test_supply_elec.export_max: 5
  scenario: simple_supply,two_hours,investment_costs
  lp_file: export_balance.lp

ramping_up:
  description: "Test ramping_up constraint"
  math:
    constraints: [ramping_up]
  overrides:
    nodes.a.techs.test_supply_elec.flow_ramping: 0.5
  scenario: simple_supply,two_hours,investment_costs
  lp_file: ramping_up.lp

ramping_down:
  description: "Test ramping_down constraint"
  math:
    constraints: [ramping_down]
  overrides:
    nodes.a.techs.test_supply_elec.flow_ramping: 0.5
  scenario: simple_supply,two_hours,investment_costs
  lp_file: ramping_down.lp

balance_demand_sink_use_equals:
  description: "Test balance_demand constraint with sink_use_equals instead of sink_use_max"
  math:
    constraints: [balance_demand]
  overrides:
    data_tables.demand_elec.add_dims.parameters: sink_use_equals
  scenario: simple_supply,two_hours
  lp_file: balance_demand_sink_use_equals.lp

balance_demand_sink_unit_per_cap:
  description: "Test balance_demand constraint with sink_unit=per_cap"
  math:
    constraints: [balance_demand]
  overrides:
    techs.test_demand_elec.sink_unit: per_cap
    nodes.a.techs.test_demand_elec.sink_use_max: 0.5
  scenario: simple_supply,two_hours,investment_costs
  lp_file: balance_demand_sink_unit_per_cap.lp

balance_demand_sink_unit_per_area:
  description: "Test balance_demand constraint with sink_unit=per_area"
  math:
    constraints: [balance_demand]
  overrides:
    techs.test_demand_elec.sink_unit: per_area
    nodes.a.techs.test_demand_elec.sink_use_max: 2.0
    nodes.a.techs.test_demand_elec.area_use_max: 50
  scenario: simple_supply,two_hours,investment_costs
  lp_file: balance_demand_sink_unit_per_area.lp

source_availability_supply_source_use_equals:
  description: "Test source_availability_supply with source_use_equals instead of source_use_max"
  math:
    constraints: [source_availability_supply]
  overrides:
    nodes.a.techs.test_supply_plus.source_use_equals: 5
  scenario: simple_supply_plus,resample_two_days,investment_costs
  lp_file: source_availability_supply_source_use_equals.lp

source_availability_supply_source_unit_per_cap:
  description: "Test source_availability_supply with source_unit=per_cap"
  math:
    constraints: [source_availability_supply]
  overrides:
    techs.test_supply_plus.source_unit: per_cap
    nodes.a.techs.test_supply_plus.source_use_max: 0.8
  scenario: simple_supply_plus,resample_two_days,investment_costs
  lp_file: source_availability_supply_source_unit_per_cap.lp

source_availability_supply_source_unit_per_area:
  description: "Test source_availability_supply with source_unit=per_area"
  math:
    constraints: [source_availability_supply]
  overrides:
    techs.test_supply_plus.source_unit: per_area
    nodes.a.techs.test_supply_plus.source_use_max: 1.5
    nodes.a.techs.test_supply_plus.area_use_max: 100
  scenario: simple_supply_plus,resample_two_days,investment_costs
  lp_file: source_availability_supply_source_unit_per_area.lp

ramping_carrier_in_only:
  description: "Test ramping constraints with a tech that has carrier_in but not carrier_out"
  math:
    constraints: [ramping_up, ramping_down]
  overrides:
    nodes.a.techs.test_conversion.flow_ramping: 0.5
  scenario: simple_conversion,two_hours,investment_costs
  lp_file: ramping_carrier_in_only.lp

ramping_carrier_in_and_out:
  description: "Test ramping constraints with a tech that has both carrier_in and carrier_out"
  math:
    constraints: [ramping_up, ramping_down]
  overrides:
    nodes.a.techs.test_conversion_plus.flow_ramping: 0.5
  scenario: conversion_and_conversion_plus,two_hours,investment_costs
  lp_file: ramping_carrier_in_and_out.lp

balance_supply_with_storage_cyclic:
  description: "Test balance_supply_with_storage constraint with cyclic_storage=True"
  math:
    constraints: [balance_supply_with_storage]
  overrides:
    nodes.a.techs.test_supply_plus.cyclic_storage: true
  scenario: simple_supply_plus,two_hours,investment_costs
  lp_file: balance_supply_with_storage_cyclic.lp
